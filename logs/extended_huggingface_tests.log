2024-11-26 09:49:53,864 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Successfully loaded tokenizer and model from BounharAbdelaziz/Transliteration-Moroccan-Darija
2024-11-26 09:49:54,624 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Starting test_load_and_preprocess_datasets
2024-11-26 09:49:56,532 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Successfully loaded dataset: web_data
2024-11-26 09:49:56,544 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: web_data
2024-11-26 09:49:57,180 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for web_data
2024-11-26 09:49:57,292 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: web_data
2024-11-26 09:49:57,792 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for web_data
2024-11-26 09:49:57,875 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: web_data
2024-11-26 09:49:58,435 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for web_data
2024-11-26 09:49:58,869 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Successfully preprocessed dataset: web_data
2024-11-26 09:50:06,603 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Successfully loaded dataset: comments
2024-11-26 09:50:06,607 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: comments
2024-11-26 09:50:06,825 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for comments
2024-11-26 09:50:08,878 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: comments
2024-11-26 09:50:09,495 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for comments
2024-11-26 09:50:10,087 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: comments
2024-11-26 09:50:10,496 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for comments
2024-11-26 09:50:10,570 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: comments
2024-11-26 09:50:10,997 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for comments
2024-11-26 09:50:11,221 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: comments
2024-11-26 09:50:11,639 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for comments
2024-11-26 09:50:11,694 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: comments
2024-11-26 09:50:12,060 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for comments
2024-11-26 09:50:12,126 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: comments
2024-11-26 09:50:12,510 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for comments
2024-11-26 09:50:12,590 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: comments
2024-11-26 09:50:12,872 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for comments
2024-11-26 09:50:12,932 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: comments
2024-11-26 09:50:13,250 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for comments
2024-11-26 09:50:13,340 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: comments
2024-11-26 09:50:13,732 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for comments
2024-11-26 09:50:14,823 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Successfully preprocessed dataset: comments
2024-11-26 09:50:17,069 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Successfully loaded dataset: stories
2024-11-26 09:50:17,083 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: stories
2024-11-26 09:50:23,276 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for stories
2024-11-26 09:50:23,415 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: stories
2024-11-26 09:50:28,241 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for stories
2024-11-26 09:50:44,348 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: stories
2024-11-26 09:50:50,732 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for stories
2024-11-26 09:50:50,979 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Successfully preprocessed dataset: stories
2024-11-26 09:50:51,993 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Successfully loaded dataset: doda
2024-11-26 09:50:51,997 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: doda
2024-11-26 09:50:52,379 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for doda
2024-11-26 09:50:52,483 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: doda
2024-11-26 09:50:52,856 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for doda
2024-11-26 09:50:52,963 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: doda
2024-11-26 09:50:53,299 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for doda
2024-11-26 09:50:53,399 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: doda
2024-11-26 09:50:53,744 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for doda
2024-11-26 09:50:53,850 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: doda
2024-11-26 09:50:54,158 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for doda
2024-11-26 09:50:54,268 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: doda
2024-11-26 09:50:54,537 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for doda
2024-11-26 09:50:54,850 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: doda
2024-11-26 09:50:55,245 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for doda
2024-11-26 09:51:05,120 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: doda
2024-11-26 09:51:05,549 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for doda
2024-11-26 09:51:08,770 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: doda
2024-11-26 09:51:08,919 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for doda
2024-11-26 09:51:13,716 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: doda
2024-11-26 09:51:13,850 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessed 1000 examples for doda
2024-11-26 09:51:15,893 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: doda
2024-11-26 09:51:16,929 - tests.unified_tests.extended_test_huggingface_datasets - ERROR - Error in preprocessing function for doda: TextEncodeInput must be Union[TextInputSequence, Tuple[InputSequence, InputSequence]]
2024-11-26 09:51:28,098 - tests.unified_tests.extended_test_huggingface_datasets - ERROR - Error processing dataset doda: TextEncodeInput must be Union[TextInputSequence, Tuple[InputSequence, InputSequence]]
2024-11-26 09:51:32,938 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Successfully loaded dataset: transliteration
2024-11-26 09:51:32,948 - tests.unified_tests.extended_test_huggingface_datasets - INFO - Preprocessing dataset: transliteration
2024-11-26 09:51:32,958 - tests.unified_tests.extended_test_huggingface_datasets - ERROR - Error processing dataset transliteration: generator raised StopIteration
2024-11-26 09:51:33,067 - root - INFO - Test Output:
test_atlasia_darija_english (tests.unified_tests.extended_test_huggingface_datasets.ExtendedTestHuggingFaceDatasets.test_atlasia_darija_english) ... ok
test_bounhar_english_to_moroccan_darija (tests.unified_tests.extended_test_huggingface_datasets.ExtendedTestHuggingFaceDatasets.test_bounhar_english_to_moroccan_darija) ... ok
test_imomayiz_darija_english (tests.unified_tests.extended_test_huggingface_datasets.ExtendedTestHuggingFaceDatasets.test_imomayiz_darija_english) ... ok
test_load_and_preprocess_datasets (tests.unified_tests.extended_test_huggingface_datasets.ExtendedTestHuggingFaceDatasets.test_load_and_preprocess_datasets) ... 
  test_load_and_preprocess_datasets (tests.unified_tests.extended_test_huggingface_datasets.ExtendedTestHuggingFaceDatasets.test_load_and_preprocess_datasets) (subset='doda') ... FAIL
  test_load_and_preprocess_datasets (tests.unified_tests.extended_test_huggingface_datasets.ExtendedTestHuggingFaceDatasets.test_load_and_preprocess_datasets) (subset='transliteration') ... FAIL
test_mad_darija_bridge (tests.unified_tests.extended_test_huggingface_datasets.ExtendedTestHuggingFaceDatasets.test_mad_darija_bridge) ... ok

======================================================================
FAIL: test_load_and_preprocess_datasets (tests.unified_tests.extended_test_huggingface_datasets.ExtendedTestHuggingFaceDatasets.test_load_and_preprocess_datasets) (subset='doda')
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/mnt/c/Users/mrdbo/Documents/ReactDev/AWS/ec2/translation-service/tests/unified_tests/extended_test_huggingface_datasets.py", line 107, in test_load_and_preprocess_datasets
    tokenized_dataset = self.raw_datasets[subset]["train"].map(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mrdbo/miniconda3/envs/dataset_test_deploy_ec2/lib/python3.11/site-packages/datasets/arrow_dataset.py", line 560, in wrapper
    out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mrdbo/miniconda3/envs/dataset_test_deploy_ec2/lib/python3.11/site-packages/datasets/arrow_dataset.py", line 3055, in map
    for rank, done, content in Dataset._map_single(**dataset_kwargs):
  File "/home/mrdbo/miniconda3/envs/dataset_test_deploy_ec2/lib/python3.11/site-packages/datasets/arrow_dataset.py", line 3458, in _map_single
    batch = apply_function_on_filtered_inputs(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mrdbo/miniconda3/envs/dataset_test_deploy_ec2/lib/python3.11/site-packages/datasets/arrow_dataset.py", line 3320, in apply_function_on_filtered_inputs
    processed_inputs = function(*fn_args, *additional_args, **fn_kwargs)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/c/Users/mrdbo/Documents/ReactDev/AWS/ec2/translation-service/tests/unified_tests/extended_test_huggingface_datasets.py", line 108, in <lambda>
    lambda x: self.preprocess_function(x, subset),
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/c/Users/mrdbo/Documents/ReactDev/AWS/ec2/translation-service/tests/unified_tests/extended_test_huggingface_datasets.py", line 77, in preprocess_function
    labels = [self.tokenizer.encode(text, add_special_tokens=True, max_length=max_target_length, truncation=True, padding='max_length') for text in target_text]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/c/Users/mrdbo/Documents/ReactDev/AWS/ec2/translation-service/tests/unified_tests/extended_test_huggingface_datasets.py", line 77, in <listcomp>
    labels = [self.tokenizer.encode(text, add_special_tokens=True, max_length=max_target_length, truncation=True, padding='max_length') for text in target_text]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mrdbo/miniconda3/envs/dataset_test_deploy_ec2/lib/python3.11/site-packages/transformers/tokenization_utils_base.py", line 2788, in encode
    encoded_inputs = self.encode_plus(
                     ^^^^^^^^^^^^^^^^^
  File "/home/mrdbo/miniconda3/envs/dataset_test_deploy_ec2/lib/python3.11/site-packages/transformers/tokenization_utils_base.py", line 3207, in encode_plus
    return self._encode_plus(
           ^^^^^^^^^^^^^^^^^^
  File "/home/mrdbo/miniconda3/envs/dataset_test_deploy_ec2/lib/python3.11/site-packages/transformers/tokenization_utils_fast.py", line 603, in _encode_plus
    batched_output = self._batch_encode_plus(
                     ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mrdbo/miniconda3/envs/dataset_test_deploy_ec2/lib/python3.11/site-packages/transformers/tokenization_utils_fast.py", line 529, in _batch_encode_plus
    encodings = self._tokenizer.encode_batch(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: TextEncodeInput must be Union[TextInputSequence, Tuple[InputSequence, InputSequence]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/mnt/c/Users/mrdbo/Documents/ReactDev/AWS/ec2/translation-service/tests/unified_tests/extended_test_huggingface_datasets.py", line 118, in test_load_and_preprocess_datasets
    self.fail(f"Failed to process dataset {subset}: {e}")
AssertionError: Failed to process dataset doda: TextEncodeInput must be Union[TextInputSequence, Tuple[InputSequence, InputSequence]]

======================================================================
FAIL: test_load_and_preprocess_datasets (tests.unified_tests.extended_test_huggingface_datasets.ExtendedTestHuggingFaceDatasets.test_load_and_preprocess_datasets) (subset='transliteration')
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/mrdbo/miniconda3/envs/dataset_test_deploy_ec2/lib/python3.11/site-packages/datasets/arrow_dataset.py", line 3458, in _map_single
    batch = apply_function_on_filtered_inputs(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mrdbo/miniconda3/envs/dataset_test_deploy_ec2/lib/python3.11/site-packages/datasets/arrow_dataset.py", line 3320, in apply_function_on_filtered_inputs
    processed_inputs = function(*fn_args, *additional_args, **fn_kwargs)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/c/Users/mrdbo/Documents/ReactDev/AWS/ec2/translation-service/tests/unified_tests/extended_test_huggingface_datasets.py", line 108, in <lambda>
    lambda x: self.preprocess_function(x, subset),
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/c/Users/mrdbo/Documents/ReactDev/AWS/ec2/translation-service/tests/unified_tests/extended_test_huggingface_datasets.py", line 59, in preprocess_function
    darija_col, english_col = self.get_column_names(subset)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/c/Users/mrdbo/Documents/ReactDev/AWS/ec2/translation-service/tests/unified_tests/extended_test_huggingface_datasets.py", line 51, in get_column_names
    english_col = next(col for col in required_columns if col in self.config['column_types']['english'])
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
StopIteration

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/c/Users/mrdbo/Documents/ReactDev/AWS/ec2/translation-service/tests/unified_tests/extended_test_huggingface_datasets.py", line 107, in test_load_and_preprocess_datasets
    tokenized_dataset = self.raw_datasets[subset]["train"].map(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mrdbo/miniconda3/envs/dataset_test_deploy_ec2/lib/python3.11/site-packages/datasets/arrow_dataset.py", line 560, in wrapper
    out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mrdbo/miniconda3/envs/dataset_test_deploy_ec2/lib/python3.11/site-packages/datasets/arrow_dataset.py", line 3055, in map
    for rank, done, content in Dataset._map_single(**dataset_kwargs):
RuntimeError: generator raised StopIteration

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/mnt/c/Users/mrdbo/Documents/ReactDev/AWS/ec2/translation-service/tests/unified_tests/extended_test_huggingface_datasets.py", line 118, in test_load_and_preprocess_datasets
    self.fail(f"Failed to process dataset {subset}: {e}")
AssertionError: Failed to process dataset transliteration: generator raised StopIteration

----------------------------------------------------------------------
Ran 5 tests in 119.029s

FAILED (failures=2)

2024-11-26 09:51:33,072 - root - INFO - 
Test Summary:
Ran 5 tests
Successes: 3
Failures: 2
Errors: 0

